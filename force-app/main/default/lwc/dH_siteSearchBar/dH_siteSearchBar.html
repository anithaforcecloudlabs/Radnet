<!-- 
* ***************************************************************************************************************************
* LWC Component Name - dH_siteSearchBar.html
* Version - 0.1
* Created Date - 13-June-2024
* Function - HTML class to provide the Site Search functionality in the P360 view.
* Modification Log :
* ***************************************************************************************************************************
* Jira#             Date                 Description
* ********       **************      ***********************************************************************************
* CC-489          13-June-2024         Added a search bar which will display the list of site when user enters a search key and
                                        onRecordSelection functionality to open the Site search and display the result.
* **********************************************************************************************************************************
-->
<template>
    <div class="card-container">
        <div class="card-header">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <!--To display the icon-->
                <div class="slds-media__figure">
                    <span
                        class="icon slds-icon_container slds-icon-utility-feed slds-input__icon slds-input__icon_left">
                        <lightning-icon icon-name="utility:feed" size="small" title={label.SiteSearch}
                            class="iconposition slds-icon  slds-icon_medium slds-icon-text-default slds-icon-standard-search slds-icon_container"
                            aria-hidden="true">
                        </lightning-icon>
                    </span>
                </div>
                <div class="slds-media__body">
                    <h1 class="slds-card__header-title">
                        {label.SiteSearch}
                    </h1>
                </div>
            </header>
        </div>
        <div class="card-body">
            <div class="slds-form-element__control">
                <div class="slds-combobox_container">
                    <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open"
                        aria-expanded="true" aria-haspopup="listbox" role="combobox">
                        <template if:true={selectedValue}>
                            <div data-key="pilldiv"
                                class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
                                role="none">
                                <input type="text" class="slds-input slds-combobox__input slds-combobox__input-value"
                                    id="combobox-id-5" aria-controls="listbox-id-5" role="textbox"
                                    placeholder={label.SelectAnOption} readonly value={selectedValue} />
                                <button class="slds-button slds-button_icon slds-input__icon slds-input__icon_right"
                                    onclick={removeRecordOnLookup} title={label.RemoveSelectedRecord}>
                                    <span class="slds-button__icon" aria-hidden="true">
                                        <lightning-icon icon-name="utility:clear" size="xx-Small"
                                            class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default"
                                            aria-hidden="true">
                                        </lightning-icon>
                                    </span>
                                    <span class="slds-assistive-text">
                                        {label.RemoveSelectedRecord}
                                    </span>
                                </button>
                            </div>
                        </template>
                        <template if:false={selectedValue}>
                            <div data-key="searchdiv"
                                class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_left"
                                role="none">
                                <input type="text" onfocusout={onLeave} value={searchKey} onkeyup={handleKeyChange}
                                    onchange={handleKeyChange} class="slds-input slds-combobox__input slds-col inputbox"
                                    id="combobox-id-2" aria-autocomplete="list" aria-controls="listbox-id-2"
                                    role="textbox" placeholder={label.SearchSiteCodeSiteName} />
                                <span
                                    class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_right">
                                    <lightning-icon icon-name="utility:search" size="xx-Small"
                                        class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default"
                                        aria-hidden="true">
                                    </lightning-icon>
                                </span>
                            </div>
                            <template if:true={hasRecords}>
                                <div id="listbox-id-2-venu" data-key="dropdownresult"
                                    class="slds-show slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid"
                                    role="listbox">
                                    <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                        <template if:true={message}>
                                            <center>
                                                {message}
                                            </center>
                                        </template>
                                        <template for:each={recordsList} for:item="record">
                                            <li id={record.Id} key={record.Id} onclick={onRecordSelection}
                                                role="presentation" class="slds-listbox__item">
                                                <div data-key={record.Id} data-name={record.Name}
                                                    class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta"
                                                    role="option">
                                                    <span class="slds-media__body">
                                                        <span data-key={record.Id} data-name={record.Name}
                                                            class="slds-listbox__option-text slds-listbox__option-text_entity">
                                                            {record.Name}
                                                        </span>
                                                    </span>
                                                </div>
                                            </li>
                                        </template>
                                    </ul>
                                </div>
                            </template>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>